import { FETCH_POSTS, FETCH_POSTS_ERROR, FETCH_MEDIA, FETCH_MEDIA_ERROR } from './types';
import { getDiscussionsFromAPI, getMediaItem } from '../helpers/apiHelpers';

const testPosts = [{
  id: 39339798, author: 'berniesanders', permlink: 'dmania-is-bad-for-steem-time-to-take-this-shit-down', category: 'steem', parent_author: '', parent_permlink: 'steem', title: '@dmania is BAD FOR STEEM - rewarding plagiarizers and thieves!', body: "<html>\n<h1>@ned supports @dmaina.</h1>\n<h1>@dmania supports plagiarism and <a href=\"https://steemit.com/dmania/@garudi/stunning-in-its-ugliness-nutella-is-delish-zg1hbmlh-zuui4\">stealing others original work</a>.</h1>\n<h1>Does @ned support plagiarism and stealing others original work?</h1>\n<p><br></p>\n<p>Example: &nbsp;<a href=\"https://steemit.com/dmania/@garudi/yokai-watch-is-where-its-at-zg1hbmlh-cde5r\">$25 reward for a STOLEN image with 0 attribution provided</a><br>\nExample: <a href=\"https://steemit.com/dmania/@garudi/stunning-in-its-ugliness-nutella-is-delish-zg1hbmlh-zuui4\">Stolen Nutella image</a><br>\n<a href=\"https://steemit.com/dmania/@garudi/baby-get-face-mauled-by-viscous-dog-zg1hbmlh-2uae3\">Another example...</a><br>\n<a href=\"http://dmania.lol/post/horpey/cryptocurrency-investors-addict-zg1hbmlh-crt2y\">Here's one too...</a><br>\n<a href=\"http://dmania.lol/post/therockman/why-i-always-carry-a-picture-of-my-family-in-my-wallet-zg1hbmlh-hoa2b\">At least put some effort into it!</a></p>\n<p>If you want more examples, do a Google reverse image search on pretty much any high paying shitmeme <a href=\"http://dmania.lol\">here</a>.</p>\n<p><br></p>\n</html>", json_metadata: '{"review_type":"show","tmdb_id":"1407","tags":["steem","steemit","dmania","theft","review.app"],"users":["ned","dmaina","dmania"],"app":"steemit/0.1","format":"html","links":["https://steemit.com/dmania/@garudi/stunning-in-its-ugliness-nutella-is-delish-zg1hbmlh-zuui4","https://steemit.com/dmania/@garudi/yokai-watch-is-where-its-at-zg1hbmlh-cde5r","https://steemit.com/dmania/@garudi/baby-get-face-mauled-by-viscous-dog-zg1hbmlh-2uae3","http://dmania.lol/post/horpey/cryptocurrency-investors-addict-zg1hbmlh-crt2y","http://dmania.lol/post/therockman/why-i-always-carry-a-picture-of-my-family-in-my-wallet-zg1hbmlh-hoa2b","http://dmania.lol"]}', last_update: '2018-03-19T02:42:39', created: '2018-03-19T01:09:03', active: '2018-03-19T23:35:39', last_payout: '1970-01-01T00:00:00', depth: 0, children: 249, net_rshares: '155191986583465', abs_rshares: '155320528485475', vote_rshares: '155263683650392', children_abs_rshares: '173388126561605', cashout_time: '2018-03-26T01:09:03', max_cashout_time: '1969-12-31T23:59:59', total_vote_weight: 13012520, reward_weight: 10000, total_payout_value: '0.000 SBD', curator_payout_value: '0.000 SBD', author_rewards: 0, net_votes: 788, root_comment: 39339798, max_accepted_payout: '1000000.000 SBD', percent_steem_dollars: 10000, allow_replies: true, allow_votes: true, allow_curation_rewards: true, beneficiaries: [], url: '/steem/@berniesanders/dmania-is-bad-for-steem-time-to-take-this-shit-down', root_title: '@dmania is BAD FOR STEEM - rewarding plagiarizers and thieves!', pending_payout_value: '473.198 SBD', total_pending_payout_value: '0.000 STEEM', replies: [], author_reputation: -47256007567876, promoted: '0.000 SBD', body_length: 1172, reblogged_by: [],
}, {
  id: 39342502, author: 'upmewhale', permlink: 'official-website-updates-of-upmewhale', category: 'website', parent_author: '', parent_permlink: 'website', title: 'Official Website Updates Of @Upmewhale', body: '# Hello Dear Users Of @upmewhale!\n\nI am going to announced that we have launched the official website  http://upmewhale.com\n\n# Special Offers For Users \n Weekly One Top Author will Get Reward For Best original post !\n\n\n* 100 % return of daily earning to the delegators .\n* Here you will get the latest details of the all happy investor.\n* On the site you will know the details regarding the bidding bots \n* You can directly use the delegation tool to the @upmewhale.\n* You can check the daily earning and pending profit from the bidding bot daily earning updated soon.\n* You can also check the amount of total investors .\n* You can get all the contact details if you have any question to ask of some suggestion you want to gave or some problem you face in different ways .\n* Detail of unvote those user who has been detected as a plagiarism or copyright content.\n### Bot Has Right to unvote all low quality stuff with no refund!\n\n# Website over view\n\n![](https://steemitimages.com/DQmXN4HiaXPPudry3neecoon7UiXzVomWjP8V1z9CYLJNBh/image.png)\n![](https://steemitimages.com/DQmPRoZdGooVwFKtvr73PiBwh4kSExAKRLyWarYYMA93WBa/image.png)\n![](https://steemitimages.com/DQmWiXarjkXtCrnJGKkaJQbTxY9nNgPAj2W1RixfG1DL1ff/image.png)\n![](https://steemitimages.com/DQmSksXRZ24roFYxHUJw49roCGPodoCsULQtZ6ZMnf73dVb/image.png)\n![](https://steemitimages.com/DQmdQmMLR13PJgjkxrvq4dLY9xJQ8inGTWRSN7n8NnccBev/image.png)\n![](https://steemitimages.com/DQmdZsckQjhjVxD5NUhXZdSMpjNNQwLiq3my86v4jfNaFGY/image.png)\n\nSPECIAL THANKS To @yababmatt  For supporting the developing and running of the bot.\n\n -[click here  !](http://upmewhale.com) to visit the upmewhale official site', json_metadata: '{"review_type":"movie","tmdb_id":"284054", "tags":["website","upmewhale","bot","steemit","review.app"],"users":["upmewhale","yababmatt"],"image":["https://steemitimages.com/DQmXN4HiaXPPudry3neecoon7UiXzVomWjP8V1z9CYLJNBh/image.png","https://steemitimages.com/DQmPRoZdGooVwFKtvr73PiBwh4kSExAKRLyWarYYMA93WBa/image.png","https://steemitimages.com/DQmWiXarjkXtCrnJGKkaJQbTxY9nNgPAj2W1RixfG1DL1ff/image.png","https://steemitimages.com/DQmSksXRZ24roFYxHUJw49roCGPodoCsULQtZ6ZMnf73dVb/image.png","https://steemitimages.com/DQmdQmMLR13PJgjkxrvq4dLY9xJQ8inGTWRSN7n8NnccBev/image.png","https://steemitimages.com/DQmdZsckQjhjVxD5NUhXZdSMpjNNQwLiq3my86v4jfNaFGY/image.png"],"links":["http://upmewhale.com"],"app":"steemit/0.1","format":"markdown"}', last_update: '2018-03-19T01:45:45', created: '2018-03-19T01:33:48', active: '2018-03-19T23:39:30', last_payout: '1970-01-01T00:00:00', depth: 0, children: 112, net_rshares: '141627383086359', abs_rshares: '141627973972395', vote_rshares: '141627973972395', children_abs_rshares: '142706272291712', cashout_time: '2018-03-26T01:33:48', max_cashout_time: '1969-12-31T23:59:59', total_vote_weight: 12609414, reward_weight: 10000, total_payout_value: '0.000 SBD', curator_payout_value: '0.000 SBD', author_rewards: 0, net_votes: 501, root_comment: 39342502, max_accepted_payout: '1000000.000 SBD', percent_steem_dollars: 10000, allow_replies: true, allow_votes: true, allow_curation_rewards: true, beneficiaries: [], url: '/website/@upmewhale/official-website-updates-of-upmewhale', root_title: 'Official Website Updates Of @Upmewhale', pending_payout_value: '431.838 SBD', total_pending_payout_value: '0.000 STEEM', replies: [], author_reputation: '3490869690525', promoted: '0.000 SBD', body_length: 1647, reblogged_by: [],
}, {
  id: 39278870, author: 'sykochica', permlink: 'answering-common-questions-what-is-the-steem-experience', category: 'steem-help', parent_author: '', parent_permlink: 'steem-help', title: '? Answering Common Questions: What is the Steem Experience?', body: "# <center>Been Looking for a Hangout?<br> Maybe even some actual voice chat?</center>\n<center>https://steemitimages.com/DQmPrVnnf7qcYidBuDiNyYGapZM22ikm5SdWVKrmGhY1Rnz/thesteemexperience.jpg</center>\n## <center></center>\n\n#### <center>[You can read the Steem Experience Intro Post Here](https://steemit.com/steem/@richardcrill/the-steem-experience-open-honest-communication-decentralized)</center>\n<br>\n\n\nOne of the first things for new Steemians is to start their search for communities they want to be a part of. It's literally impossible for somebody to be active in all of them (simply dropping post promotion links doesn't count.) It's important for us to make meaningful connections with others, beyond just their posts, to a more human level. If we truly can only maintain [150 meaningful relationships](https://www.theguardian.com/technology/2010/mar/14/my-bright-idea-robin-dunbar) at once...on some level we have to choose who we include in our 'meaningful circle.'\n\nFor many people [Steem Chat's](steem.chat) general channel is where a lot of new people first drop in to communicate (beyond Steemit).  While there are some communities over there, a lot of the channels are more geared for post promotion. So typically I direct people to browse the various Steemit communities over on Discord...but this alone can be a little daunting, let alone the time to actually find the groups they like. So wouldn't it be nice to have a nice equivalent of the catch-all, newbie friendly place over on Discord?\n\n<center>![](https://steemitimages.com/DQmToSGowZ598ChGA2p32S6h5UU3RbfpyncauAP5NJ87S6G/image.png)</center>\n\nWe'll...now you do with the [Steem Experience!](https://discord.gg/zAAkK2p) It's somewhere you can go just to hangout, listen to music, have discussions with great people, make audio recordings, get to know and/or ask questions to veteran users...all while you get comfortable with using Discord and finding more niche communities for yourselves! But there's nothing like entering a room and hearing your name called like, \"Norm!\" (for those of you that remember the show Cheers.)\n<center>http://i.imgur.com/Xs4cJOi.png</center>\n\n## This sounds interesting...How do I join?\n\n**Joining is easy!**\n* If you already have a Discord account, all you have to do is [CLICK HERE!](https://discord.gg/zAAkK2p)\n* If you don't have a Discord account:\n    * First go to the [Discord Website](discordapp.com) and signup (this lets you make your username)\n    * I recommend downloading the app (versus using in browser) to your computer or mobile device\n    * Then just [CLICK HERE](https://discord.gg/zAAkK2p) to join the Steem Experience Server\n\nFor those completely new to Discord, it may be worth watching this short video:\n<center>https://www.youtube.com/watch?v=zZ08Fbs5LpM</center>\n<center>http://i.imgur.com/Xs4cJOi.png</center>\n\n## Who are some of the people commonly in there? Do people actually Voice Chat?\n<br>\nSome of the names you might recognize include: @RichardCrill, @Seablue, @KrNel, @BattleAxe, @ShadowsPub, @Sykochica, @RiskDebonair,  @Instructor2121...and so many more! You'll often find one or more people actually hanging out in the voice chat channels, sometimes having fantastic discussions, listening to music (with [rhythm bot](https://rythmbot.co/)) or even recording some audio (with [craig bot.](https://craig.chat/home/))\n\nYou also can currently find the hub of the #TeamGood initiative with their channels in here! The goal of this is to highlight people on and off the platform helping out others....essentially to \"Help the Helpers!\" You can hear more about this initiative in [this post.](https://steemit.com/dsound/@sykochica/20180304t173002384z-what-is-teamgood-whats-their-goal-tune-in-and-find-out-with-battleaxe)\n<center>http://i.imgur.com/Xs4cJOi.png</center>\n\n## Do I have to do anything to get in?\n<br>\nNope...feel free to join the community there! However much like the general channel in [Steem Chat](steem.chat), don't go in there solely to be promoting posts and spamming links...go there to get to know some great people and let them get to know you! **Steem Experience is a place for \"Good\" people to hang out with \"Good\" people!<br>Do *you* have what it takes?!?!**\n\n## <center>Interested to check out the Steem Experience on Discord?<br>[Just Click HERE!](https://discord.gg/zAAkK2p)</center>\n\n<center>http://i.imgur.com/Xs4cJOi.png</center>\n\n## <center> Please upvote and resteem if you found this guide helpful.</center>\n### <center> [Click HERE for a list of All my Guides!](https://docs.google.com/document/d/1Rt2Uon6wL-83InlWaV1VfdRr0QSsLFGqnCRvBR_5tx4/edit?usp=sharing)</center>\n\n<center>https://steemitimages.com/DQmRnxxSrmCL9QjT6n38MRoJ3JYgeXMmn4jMs2YzzhL3Gtb/image.png</center>\n\nhttp://i.imgur.com/sKiCvWa.png\n\n[![step1.png](https://res.cloudinary.com/hpiynhbhq/image/upload/v1518992279/eyny207a7vzqmaeo4jrt.png)](https://discord.gg/Z7jAJcn)\n<br>\n\n[![TGP_Light_Banner.jpg](https://steemitimages.com/DQmYpVC9dSovdGoR8FYWkJR4FGzXgc5XRZMghSQ3V7RR2aP/TGP_Light_Banner.jpg)](https://discord.gg/QU8ASsh)\n\n<center>http://i.imgur.com/Xs4cJOi.png</center>\n\n\nImage Sources:\n[Steem Experience](https://steemit.com/steem/@richardcrill/the-steem-experience-open-honest-communication-decentralized)\n[Norm](http://forums.previously.tv/topic/55292-s05e05-dreams-die-first/)", json_metadata: '{"review_type":"show","tmdb_id":"1402","tags":["steem-help","steemit","faq","steemexperience","teamgood"],"users":["richardcrill","seablue","krnel","battleaxe","shadowspub","sykochica","riskdebonair"],"image":["https://steemitimages.com/DQmPrVnnf7qcYidBuDiNyYGapZM22ikm5SdWVKrmGhY1Rnz/thesteemexperience.jpg","https://steemitimages.com/DQmToSGowZ598ChGA2p32S6h5UU3RbfpyncauAP5NJ87S6G/image.png","http://i.imgur.com/Xs4cJOi.png","https://img.youtube.com/vi/zZ08Fbs5LpM/0.jpg","https://steemitimages.com/DQmRnxxSrmCL9QjT6n38MRoJ3JYgeXMmn4jMs2YzzhL3Gtb/image.png","http://i.imgur.com/sKiCvWa.png","https://res.cloudinary.com/hpiynhbhq/image/upload/v1518992279/eyny207a7vzqmaeo4jrt.png","https://steemitimages.com/DQmYpVC9dSovdGoR8FYWkJR4FGzXgc5XRZMghSQ3V7RR2aP/TGP_Light_Banner.jpg"],"links":["https://steemit.com/steem/@richardcrill/the-steem-experience-open-honest-communication-decentralized","https://www.theguardian.com/technology/2010/mar/14/my-bright-idea-robin-dunbar","steem.chat","https://discord.gg/zAAkK2p","discordapp.com","https://www.youtube.com/watch?v=zZ08Fbs5LpM","https://rythmbot.co/","https://craig.chat/home/","https://steemit.com/dsound/@sykochica/20180304t173002384z-what-is-teamgood-whats-their-goal-tune-in-and-find-out-with-battleaxe","https://docs.google.com/document/d/1Rt2Uon6wL-83InlWaV1VfdRr0QSsLFGqnCRvBR_5tx4/edit?usp=sharing","https://discord.gg/Z7jAJcn","https://discord.gg/QU8ASsh","http://forums.previously.tv/topic/55292-s05e05-dreams-die-first/"],"app":"steemit/0.1","format":"markdown"}', last_update: '2018-03-19T03:10:00', created: '2018-03-18T16:38:42', active: '2018-03-19T23:34:15', last_payout: '1970-01-01T00:00:00', depth: 0, children: 173, net_rshares: '144210465060594', abs_rshares: '144294870700536', vote_rshares: '144212428560348', children_abs_rshares: '146843044617280', cashout_time: '2018-03-25T16:38:42', max_cashout_time: '1969-12-31T23:59:59', total_vote_weight: 12647167, reward_weight: 10000, total_payout_value: '0.000 SBD', curator_payout_value: '0.000 SBD', author_rewards: 0, net_votes: 900, root_comment: 39278870, max_accepted_payout: '1000000.000 SBD', percent_steem_dollars: 10000, allow_replies: true, allow_votes: true, allow_curation_rewards: true, beneficiaries: [], url: '/steem-help/@sykochica/answering-common-questions-what-is-the-steem-experience', root_title: '? Answering Common Questions: What is the Steem Experience?', pending_payout_value: '439.714 SBD', total_pending_payout_value: '0.000 STEEM', replies: [], author_reputation: '115029627451056', promoted: '0.000 SBD', body_length: 5322, reblogged_by: [],
}, {
  id: 1, title: 'Just a test', json_metadata: '{"review_type":"movie","tmdb_id":"338970","tags":["steem","steemit","dmania","theft","review.app"]}',
}, {
  id: 2, title: 'Just a test', json_metadata: '{"review_type":"movie","tmdb_id":"337167","tags":["steem","steemit","dmania","theft","review.app"]}',
}, {
  id: 3, title: 'Just a test', json_metadata: '{"review_type":"movie","tmdb_id":"354912","tags":["steem","steemit","dmania","theft","review.app"]}',
}, {
  id: 4, title: 'Just a test', json_metadata: '{"review_type":"movie","tmdb_id":"399055","tags":["steem","steemit","dmania","theft","review.app"]}',
}, {
  id: 5, title: 'Just a test', json_metadata: '{"review_type":"movie","tmdb_id":"335984","tags":["steem","steemit","dmania","theft","review.app"]}',
}, {
  id: 6, title: 'Just a test', json_metadata: '{"review_type":"movie","tmdb_id":"343668","tags":["steem","steemit","dmania","theft","review.app"]}',
}, {
  id: 7, title: 'Just a test', json_metadata: '{"review_type":"movie","tmdb_id":"374720","tags":["steem","steemit","dmania","theft","review.app"]}',
}];

const getTmdbIdFromPost = post => JSON.parse(post.json_metadata).tmdb_id;
const getReviewTypeFromPost = post => JSON.parse(post.json_metadata).review_type;
const getEpisodeNumberFromPost = post => JSON.parse(post.json_metadata).episode_num;
const getSeasonNumberFromPost = post => JSON.parse(post.json_metadata).season_num;

export function fetchMediaItems(posts) {
  return Promise.all(posts.map(post => getMediaItem(getReviewTypeFromPost(post), {
    id: getTmdbIdFromPost(post),
    season_number: getSeasonNumberFromPost(post),
    episode_number: getEpisodeNumberFromPost(post),
  })));
}

export const fetchMedia = posts => (dispatch) => {
  fetchMediaItems(posts)
    .then((mediaItems) => {
      const media = [];
      mediaItems.forEach((item) => {
        const newItem = item;
        const index = mediaItems.indexOf(item);
        newItem.postId = posts[index].id;
        media.push(newItem);
      });
      dispatch({
        type: FETCH_MEDIA,
        payload: media,
      });
    })
    .catch(err => dispatch({
      type: FETCH_MEDIA_ERROR,
      payload: err,
    }));
};

export const fetchPosts = () => (dispatch) => {
  getDiscussionsFromAPI({ limit: 10 })
    .then(dispatch({
      type: FETCH_POSTS,
      payload: testPosts,
    }))
    .catch(err => dispatch({
      type: FETCH_POSTS_ERROR,
      payload: err,
    }));
};


export default fetchPosts;
